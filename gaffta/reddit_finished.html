<!doctype html>
<html>
<head>
    <meta charset='utf-8' />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="d3.v2.min.js"></script>
    <style>
      svg {
        width: 700px;
        height: 400px;
      }

      .selected {
        stroke: red;
        stroke-width: 3;
      }
    </style>

    </head>

<body>
  <!-- user inputs -->
  <div id="controls">
    <select id="selector">
      <option value="pics">pics</option>
      <option value="programming">programming</option>
      <option value="gifs">gifs</option>
      <option value="d3js">d3js</option>
    </select>
  </div>

  <!-- visualization -->
  <svg id="chart" class="chart1">
  </svg>

  
  <div id="info">
  </div>

  <script>
    //easily get json data for any reddit url
    function getData(endpoint, callback) {
      //reddits api is nice so we can use JSONP
      var url = "http://www.reddit.com/r/" + endpoint + ".json?jsonp=?";
      $.getJSON(url, function(results) {
        callback(results);
      })
    }

    var cx = 100;
    var cy = 100;
    var chartHeight = 300;


    function makeChart(disdata) {
      console.log("make chart", disdata);
      var datdata = disdata.data.children;

      var min = 0;//d3.min(datdata, function(d) { return d.data.score });
      var max = d3.max(datdata, function(d) { return d.data.score });
      //console.log("min, max", min, max);

      var yscale = d3.scale.linear()
        .domain([min, max])
        .range([0, chartHeight]);

      var svg = d3.select(".chart1");

      var rects = svg.selectAll("rect")
        .data(datdata);

      rects.enter()
        .append("rect")
        .attr("fill", "#00ff00")
        .attr("transform", function(d,i) {
          var x = cx + i * 30;
          var y = cy + chartHeight;
          return "translate(" + [x,y] + ")";
        });

      rects.exit()
        .transition()
        .duration(1500)
        .attr("height", 0)
        .attr("transform", function(d,i) {
          var x = cx + i * 30;
          var y = cy + chartHeight;
          return "translate(" + [x,y] + ")";
        })
        .attr("fill", "#ff0000")
        .remove()

      rects.attr("width", 20)

      rects.transition()
        .duration(1500)
        .attr("transform", function(d,i) {
          var x = cx + i * 30;
          var y = cy + chartHeight - yscale(d.data.score);
          return "translate(" + [x,y] + ")";
        })
        .attr("height", function(d) {
          return yscale(d.data.score);
        })
        .attr("fill", "#0000ff")


      rects.on("click", function(d) {
        makeInfo(d);
      })
      .on("mouseover", function(d) {
        d3.select(this).classed("selected", true)
      })
      .on("mouseout", function(d) {
        d3.select(this).classed("selected", false)
      })
    }

    function makeInfo(data) {
      //console.log("make info:", data);
      var info = d3.select("#info").html("");

      info.append("span").text(data.data.title);
      info.append("img").attr("src", data.data.thumbnail)
    }

    //example usage
    getData("pics", makeChart)

    var selector = d3.select("#selector")
      .on("change", function() {
        var index = selector.node().selectedIndex;
        var value = selector.node()[index].value;
        
        getData(value, makeChart);
      })


  </script>

</body>
</html>

